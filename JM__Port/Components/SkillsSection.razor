@using Microsoft.AspNetCore.Components
@inject IJSRuntime JSRuntime

<section id="skills" class="skills-section">
    <div class="container">
        <h2 class="section-title animate-on-scroll">Skills & Expertise</h2>

        <!-- Skills Carousel -->
        <div class="skills-carousel">
            <div class="carousel-container">
                <!-- Slide 1: Backend Skills -->
                <div class="skills-slide active">
                    <div class="skills-grid">
                        <CircleProgress Percent="95" Label="C# & .NET" />
                        <CircleProgress Percent="90" Label="ASP.NET Core" />
                        <CircleProgress Percent="85" Label="Entity Framework" />
                    </div>
                </div>

                <!-- Slide 2: Frontend Skills -->
                <div class="skills-slide">
                    <div class="skills-grid">
                        <CircleProgress Percent="90" Label="Blazor" />
                        <CircleProgress Percent="88" Label="HTML/CSS/JS" />
                        <CircleProgress Percent="85" Label="Responsive Design" />
                    </div>
                </div>

                <!-- Slide 3: Mobile & Others -->
                <div class="skills-slide">
                    <div class="skills-grid">
                        <CircleProgress Percent="80" Label="Mobile Development" />
                        <CircleProgress Percent="85" Label="SQL Databases" />
                        <CircleProgress Percent="82" Label="Git & DevOps" />
                    </div>
                </div>
            </div>
        </div>

            <!-- Carousel Controls -->
            <div class="carousel-controls">
                <button class="carousel-prev" @onclick="PrevSlide">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>

                <div class="carousel-indicators">
                    <span class="indicator @(CurrentSlide == 0 ? "active" : "")" @onclick="() => GoToSlide(0)"></span>
                    <span class="indicator @(CurrentSlide == 1 ? "active" : "")" @onclick="() => GoToSlide(1)"></span>
                    <span class="indicator @(CurrentSlide == 2 ? "active" : "")" @onclick="() => GoToSlide(2)"></span>
                </div>

                <button class="carousel-next" @onclick="NextSlide">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>
    </div>
</section>

@code {
    private int CurrentSlide = 0;
    private const int TotalSlides = 3;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await JSRuntime.InvokeVoidAsync("addGradientDefinition");
            await JSRuntime.InvokeVoidAsync("initializeSkillsAnimation");
        }
    }

    private async Task NextSlide()
    {
        CurrentSlide = (CurrentSlide + 1) % TotalSlides;
        await JSRuntime.InvokeVoidAsync("updateCarousel", CurrentSlide);
        StateHasChanged();
    }

    private async Task PrevSlide()
    {
        CurrentSlide = (CurrentSlide - 1 + TotalSlides) % TotalSlides;
        await JSRuntime.InvokeVoidAsync("updateCarousel", CurrentSlide);
        StateHasChanged();
    }

    private async Task GoToSlide(int slideIndex)
    {
        CurrentSlide = slideIndex;
        await JSRuntime.InvokeVoidAsync("updateCarousel", CurrentSlide);
        StateHasChanged();
    }
}
